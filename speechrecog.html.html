<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Speech API </title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&display=swap" rel="stylesheet">

</head>

<style>

body {
        font-family: 'Montserrat', sans-serif;
        font-size: 20px;

       }

           .blue-background {
            color: white;        /* Text color */
            background-color: blue; /* Background color */
            font-size: 30px;

        }
</style>
<body>

    <button id="startButton">Start!!!</button>
    <p id="output1"></p>
    <p id="output2"></p>
    <p id="output3"></p>
    <p id="output4"></p>
    <p id="output5"></p>
    <p id="output6"></p>
    <p id="output7"></p>
    <p id="output8"></p>
    <p id="output9"></p>

<!--
        <script>

        const startButton = document.getElementById('startButton');
        const output = document.getElementById('output');
        const recognition = new webkitSpeechRecognition(); // For Chrome, use webkitSpeechRecognition
        const output1 = document.getElementById('output1');  // Output element 1
        const output2 = document.getElementById('output2');  // Output element 2
        const output3 = document.getElementById('output3');  // Output element 3
        const output4 = document.getElementById('output4');  // Output element 4
        const output5 = document.getElementById('output5');  // Output element 5
        const output6 = document.getElementById('output6');  // Output element 5
        const output7 = document.getElementById('output7');  // Output element 5
        const output8 = document.getElementById('output8');  // Output element 5
        const output9 = document.getElementById('output9');  // Output element 5

        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = 'ur-PK';
        let sentences = []; // Declare and initialize the sentences array here
        let myArray = []
        const maxSentences = 13;
        recognition.onstart = () => {
            console.log('Speech recognition started');
        };

        recognition.onerror = (event) => {
            console.error('Speech recognition error:', event.error);
            recognition.start();
        };

               recognition.onaudioend = (event) => {
            console.error('Speech recognition onaudioend:');
        };
recognition.onspeechstart = () => {
  console.log("Speech has been detected");
};
                       recognition.onaudiostart = (event) => {
            console.error('Speech recognition onaudiostart:');
            recognition.start();
        };

        recognition.onspeechend = () => {
  console.log("Speech has stopped being detected");
};

        recognition.onresult = (event) => {
            const transcript = event.results[event.results.length - 1][0].transcript;

         //console.log(event.results[0].isFinal);
         myArray.push(transcript);
        persentence=15

// based on the length of array, set content on different output elements
switch (myArray.length) {
    case 1:
    output1.textContent = transcript;
        break;
    case 2:

       output2.textContent = transcript;

        break;
    case 3:


        output3.textContent = transcript;

        break;
    case 4:

       output4.textContent = transcript;

        break;
    case 5:

       output5.textContent = transcript;

        break;
        case 6:

       output6.textContent = transcript;

        break;
            case 7:

       output7.textContent = transcript;

        break;
          case 8:
  output8.textContent = transcript;
        break;
          case 9:
     output9.textContent = transcript;}
        break;
    default:
            console.log('Exceeded max number of outputs');
            // Clear all outputs and reset the array
            output1.textContent = '';
            output2.textContent = '';
            output3.textContent = '';
            output4.textContent = '';
            output5.textContent = '';
            output6.textContent = '';
            output7.textContent = '';
            output8.textContent = '';
            output9.textContent = '';

            // ... include clear statements for output3 to output9 ...
            output9.textContent = '';
            myArray = []; // Reset the array
            break;

};

startButton.addEventListener('click', () => {
    console.log('Speech recognition started');
    recognition.start();
});
};


        startButton.addEventListener('click', () => {
            console.log('Speech recognition started');
            recognition.start();
        });
    </script>
-->


    <script>
        function callOpenAI(prompt) {
            //prompt: "please properly translate the Irish accent english to English. The text is recognized by Speech to text engine. So please correct it, according to the context. " + prompt,
            //prompt: "You are a Multilingual (Arabic, Urdu, English) islamic interpreter having diverse knowledge of Islam, english, fiqh, Islamic jurisprudence and expert on translating from Urdu to English usually for the sermons and Islamic Lectures. Please be noted that this sermon/lecture is bilingual of Urdu and Arabic. So please leave the arabic even if you are given. Your task is to translate only the last input; from urdu text into english even if it is not making sense(translate it at your best capability) but it should not be against the teachings of Islam. You might need to change some words because some words might be mistakenly wrote as the text is extracted from speech to text engine, correct the words or sentence, avoid outputting any blasphemous sentence, and evaluate what you are outputting as Islam is a sensitive topic. fix where needed based on your Islamic knowledge, fiqh and context,and according to the context of the topic what is right now. Sometimes mispronounced words may be wrongly converted to text, and it makes something very inaccurate or blasphemous in terms of Islamic circle or it might convey inaccurate meaning. Only some words are not recognized properly which are usually have the same sound so correct them based on the context of the texts. Output nothing else than the translated text. For example  بے ایمان والو روزے تم پر فرض کیے گئے ہیں , After cross checking with the general and Islamic knowledge, it should be Oh believers and not Oh disbelievers, fasting has been enjoined upon you. Here is the input: " + prompt,
            //prompt: "You are an excellent Irish local person who is good in accents of all parts of Ireland, mostly derry and all difficult accent of Ireland and knows english very well. The text is recognized by Speech to text engine. please properly fix the input text to proper sentences by considering similar sounded words in Irish accents and output the response. So please correct it, according to the context. And the person is using short form like hadnt instead of had not: Just Fix, dont output anything else:  " + prompt,
            //prompt: "You are a Multilingual (Arabic, Urdu, English) islamic interpreter having diverse knowledge of Islam, english, fiqh, Islamic jurisprudence and expert on translating from Urdu to English usually for the sermons and Islamic Lectures. Please be noted that this sermon/lecture is bilingual of Urdu and Arabic. So please leave the arabic even if you are given. Your task is to translate only the last input; from urdu text into english even if it is not making sense(translate it at your best capability) but it should not be against the teachings of Islam. You might need to change some words because some words might be mistakenly wrote as the text is extracted from speech to text engine, correct the words or sentence, avoid outputting any blasphemous sentence, and evaluate what you are outputting as Islam is a sensitive topic. fix where needed based on your Islamic knowledge, fiqh and context,and according to the context of the topic what is right now. Sometimes mispronounced words may be wrongly converted to text, and it makes something very inaccurate or blasphemous in terms of Islamic circle or it might convey inaccurate meaning. Only some words are not recognized properly which are usually have the same sound so correct them based on the context of the texts. Output nothing else than the translated text. For example  بے ایمان والو روزے تم پر فرض کیے گئے ہیں , After cross checking with the general and Islamic knowledge, it should be Oh believers and not Oh disbelievers, fasting has been enjoined upon you. Here is the input: " + prompt,
            //prompt: "You are a Multilingual (Urdu, English) interpreter having diverse knowledge of urdu and english, good in talking and listening in bilingual of Urdu, english. and expert on translating from Urdu to English. Please be noted that the input text is bilingual of Urdu and English. They are using English words in a sentence of Urdu, and some sentence or words in a urdu sentence. Your task is to translate only the last input; from urdu text into english even if it is not making sense(translate it at your best capability). You might need to change some words because some words might be mistakenly wrote as the text is extracted from speech to text engine, correct the words or sentence, fix according to the context of the topic what is right now. Sometimes mispronounced words may be wrongly converted to text, and it makes something very inaccurate. Only some words are not recognized properly which are usually have the same sound so correct them based on the context of the texts. Output nothing else than the translated text. Kabhi kabhi I was like...... ok now Here is the input: " + prompt,
            //best
            //prompt: "You are a Multilingual Australian (Arabic, English) islamic interpreter having diverse knowledge of Islam, English literature and knows english homophones, Homonyms, Accents and Dialects, Context-Dependent Words, Slang, Colloquialisms fiqh, Islamic jurisprudence and expert on correcting mistake which happened in speech to text generation and rewrite it to English usually for the sermons and Islamic Lectures. Please be noted that this sermon/lecture is bilingual of Arabic, quranic verses, hadith, arabic words  and australian accent English. Your task is to translate only the last input and understand the context from previous inputs; fix it at your best capability but it should not be against the teachings of Islam. You might need to change some words because some words might be mistakenly wrote/interpreted because the text is extracted from speech to text engine, correct the words or sentence, avoid outputting any blasphemous sentence, and evaluate what you are outputting as Islam is a sensitive topic. fix where needed based on your Islamic knowledge, fiqh and context,and according to the context of the topic what is right now. Sometimes mispronounced words may be wrongly converted to text, and it makes something very inaccurate or might be blasphemous in terms of Islamic circle or it might convey inaccurate meaning. Only some words are not recognized properly which are usually have the same sound so correct them based on the context of the texts. Output nothing else than the translated text. For example, 'Worship Allah, Him and Him alone' is misrecognized as 'Worship Allah himalayan'. Ok now here is the input: " + prompt,
            //prompt: "You are irish local and an interpreter having diverse knowledge of Irish dialects, accents, English literature and knows english and irish homophones, Homonyms, Accents and Dialects, Context-Dependent Words, Slang, Colloquialisms, expert on correcting mistake which happened in speech to text generation and rewrite it to correct mistakes. Fix it at your best capability. You might need to change some words because some words might be mistakenly wrote/interpreted because the text is extracted from speech to text engine, correct the words or sentence based on context,and according to the context of the topic what is right now. Sometimes mispronounced words may be wrongly converted to text from speech, and it makes something very inaccurate. Only some words are not recognized properly which are usually have the same sound so correct them based on the context of the texts. Output nothing else than the translated text. For example, 'car' is misrecognized as 'care' as they speak this way in Irish accent. Process only the Last input from the text. Ok now here is the input: " + prompt,
            //for english sermon us ke andaer urud thori thori
           //prompt:  "You are a multilingual Islamic interpreter proficient in Arabic, Urdu, and English. Your expertise spans across Islamic studies, fiqh (Islamic jurisprudence), and English translation, often utilized during sermons and lectures. The sermon/lecture you're translating is bilingual, in Urdu and Arabic, with occasional English phrases. Your task is to accurately translate the last input from Urdu to English, even if it seems nonsensical, while ensuring it aligns with Islamic teachings. Correct any mispronounced words or inaccuracies resulting from speech-to-text conversion. Maintain sensitivity to Islamic beliefs and context. Output only the translated text. For example, if the input is 'بے ایمان والو روزے تم پر فرض کیے گئے ہیں', after verification, it should be 'Oh believers, fasting has been enjoined upon you,' not 'Oh disbelievers.' Here is the input:\n " + prompt,
           //prompt : "You are a multilingual Islamic interpreter proficient in Arabic, Urdu, English. Your expertise spans across Islamic studies, fiqh (Islamic jurisprudence), and English translation, often utilized during sermons and lectures. The sermon/lecture you're translating is bilingual, in Urdu and Arabic, with occasional English phrases. Your task is to accurately translate the last input from Urdu to English taking the context from the whole passage, even if it seems nonsensical, but strictly ensuring it aligns with Islamic teachings and not against. Correct any mispronounced words or inaccuracies resulting from speech-to-text conversion. Maintain sensitivity to Islamic beliefs and context. Output only the translated text. For example, if the input is 'بے ایمان والو روزے تم پر فرض کیے گئے ہیں', as ay eman walo and beimaan walo are homophones and after verification, it should be 'Oh believers, fasting has been enjoined upon you,' not 'Oh disbelievers, fasting has been enjoined upon you .' ok understood, so here is the input: " + prompt
           // prompt : You are a Multilingual Australian (Arabic, English) islamic interpreter having diverse knowledge of Islam, English literature and knows english homophones, Homonyms, Accents and Dialects, Context-Dependent Words, Slang, Colloquialisms fiqh, Islamic jurisprudence and expert on correcting mistake which happened in speech to text generation and rewrite it to English usually for the sermons and Islamic Lectures. Please be noted that this sermon/lecture is bilingual of Arabic, quranic verses, hadith, arabic words  and australian accent English. Your task is to translate only the last input and understand the context from previous inputs; fix it at your best capability but it should not be against the teachings of Islam. You might need to change some words because some words might be mistakenly wrote/interpreted because the text is extracted from speech to text engine, correct the words or sentence, avoid outputting any blasphemous sentence, and evaluate what you are outputting as Islam is a sensitive topic. fix where needed based on your Islamic knowledge, fiqh and context,and according to the context of the topic what is right now. Sometimes mispronounced words may be wrongly converted to text, and it makes something very inaccurate or might be blasphemous in terms of Islamic circle or it might convey inaccurate meaning. Only some words are not recognized properly which are usually have the same sound so correct them based on the context of the texts. Output nothing else than the translated text. For example, 'Worship Allah, Him and Him alone' is misrecognized as 'Worship Allah himalayan'. Ok now here is the input:
    return fetch('http://localhost:3000/api/openaioo', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            prompt: "" + prompt,
            max_tokens: 500
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log(prompt);
        if (data.choices && data.choices.length > 0 && data.choices[0].message && data.choices[0].message.content) {
            return data.choices[0].message.content;
        } else {
            throw new Error('Invalid response format');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        return Promise.reject(error);
    });
}

        const startButton = document.getElementById('startButton');
        const output = document.getElementById('output');
        const recognition = new webkitSpeechRecognition(); // For Chrome, use webkitSpeechRecognition
        const output1 = document.getElementById('output1');  // Output element 1
        const output2 = document.getElementById('output2');  // Output element 2
        const output3 = document.getElementById('output3');  // Output element 3
        const output4 = document.getElementById('output4');  // Output element 4
        const output5 = document.getElementById('output5');  // Output element 5
        const output6 = document.getElementById('output6');  // Output element 5
        const output7 = document.getElementById('output7');  // Output element 5
        const output8 = document.getElementById('output8');  // Output element 5
        const output9 = document.getElementById('output9');  // Output element 5

        recognition.continuous = true;
        recognition.interimResults = false;
        recognition.lang = 'ar-SA';
        let sentences = []; // Declare and initialize the sentences array here
        let myArray = []
        const maxSentences = 13;
        recognition.onstart = () => {
            console.log('Speech recognition started');
        };
           output1.style.color = 'black';
           output2.style.color = 'black';
            output3.style.color = 'black';
            output4.style.color = 'black';
            output5.style.color = 'black';
            output6.style.color = 'black';
            output7.style.color = 'black';
            output8.style.color = 'black';
           output9.style.color = 'black';

        recognition.onerror = (event) => {
            console.error('Speech recognition error:', event.error);
            recognition.start();
        };

        recognition.onaudioend = (event) => {
            console.error('Speech recognition onaudioend:');
            isRecognizing = false;

        };
recognition.onspeechstart = () => {
  console.log("Speech has been detected");
};

recognition.onerror = (event) => {
    console.error('Speech recognition error:', event.error);
    if (event.error !== 'no-speech' && !isRecognizing) {
        recognition.start();
    }
};

        recognition.onspeechend = () => {
  console.log("Speech has stopped being detected");
              recognition.start();

};

        recognition.onresult = (event) => {
            const transcript = event.results[event.results.length - 1][0].transcript;

            let allTranscripts = '';

            for (let i = 0; i < event.results.length; i++) {
                if( i+1 == event.results.length)
                {
                allTranscripts += 'Last input:\n\n'
                allTranscripts += event.results[i][0].transcript + ' \n\n';


                }
                else{
                       allTranscripts += event.results[i][0].transcript + ' \n\n';
                }
            }
            console.log('last input:', transcript);
            console.log('All transcripts:', allTranscripts);
            callOpenAI(allTranscripts)
    .then(data => {
        console.log(data);
        // Proceed with further execution
        myArray.push(data);
        console.log('list');
       console.log(myArray);
       switch (myArray.length) {
    case 1:
        output1.textContent =data;
        output1.classList.add("blue-background");

        output2.classList.remove("blue-background");
    output3.classList.remove("blue-background");
    output4.classList.remove("blue-background");
    output5.classList.remove("blue-background");
    output6.classList.remove("blue-background");
    output7.classList.remove("blue-background");
    output8.classList.remove("blue-background");
    output9.classList.remove("blue-background");

        break;
    case 2:
        output2.textContent = data;
                    output2.classList.add("blue-background");
                     output1.classList.remove("blue-background");

                     output3.classList.remove("blue-background");
                    output4.classList.remove("blue-background");
                    output5.classList.remove("blue-background");
                    output6.classList.remove("blue-background");
                    output7.classList.remove("blue-background");
                    output8.classList.remove("blue-background");
                    output9.classList.remove("blue-background");

        break;
    case 3:
        output3.textContent = data;
                    output3.classList.add("blue-background");
output1.classList.remove("blue-background");
output2.classList.remove("blue-background");
// Skipping output3 as per your requirement
output4.classList.remove("blue-background");
output5.classList.remove("blue-background");
output6.classList.remove("blue-background");
output7.classList.remove("blue-background");
output8.classList.remove("blue-background");
output9.classList.remove("blue-background");


        break;
    case 4:
        output4.textContent = data;
                    output4.classList.add("blue-background");

        output1.classList.remove("blue-background");
output2.classList.remove("blue-background");
output3.classList.remove("blue-background");
output5.classList.remove("blue-background");
output6.classList.remove("blue-background");
output7.classList.remove("blue-background");
output8.classList.remove("blue-background");
output9.classList.remove("blue-background");

        break;
    case 5:
        output5.textContent = data;
                    output5.classList.add("blue-background");
  output1.classList.remove("blue-background");
output2.classList.remove("blue-background");
output3.classList.remove("blue-background");
output4.classList.remove("blue-background");

output6.classList.remove("blue-background");
output7.classList.remove("blue-background");
output8.classList.remove("blue-background");
output9.classList.remove("blue-background");

        break;
        case 6:
        output6.textContent = data;
                    output6.classList.add("blue-background");
                       output1.classList.remove("blue-background");
                    output2.classList.remove("blue-background");
                    output3.classList.remove("blue-background");
                    output4.classList.remove("blue-background");
                    output5.classList.remove("blue-background");
                    output7.classList.remove("blue-background");
                    output8.classList.remove("blue-background");
                    output9.classList.remove("blue-background");
        break;
            case 7:
        output7.textContent = data;
                    output7.classList.add("blue-background");
                      output1.style.color = 'black';
                        output1.classList.remove("blue-background");
                    output2.classList.remove("blue-background");
                    output3.classList.remove("blue-background");
                    output4.classList.remove("blue-background");
                    output5.classList.remove("blue-background");
                    output6.classList.remove("blue-background");
                    output8.classList.remove("blue-background");
                    output9.classList.remove("blue-background");
// baqio ka font chota
        break;
          case 8:
        output8.textContent = data;

                    output8.classList.add("blue-background");
                       output1.classList.remove("blue-background");
                    output2.classList.remove("blue-background");
                    output3.classList.remove("blue-background");
                    output4.classList.remove("blue-background");
                    output5.classList.remove("blue-background");
                    output6.classList.remove("blue-background");
                    output7.classList.remove("blue-background");
                    output9.classList.remove("blue-background");

        break;
          case 9:
        output9.textContent = data;
                    //output9.classList.add("blue-background");
                    output1.classList.remove("blue-background");
                    output2.classList.remove("blue-background");
                    output3.classList.remove("blue-background");
                    output4.classList.remove("blue-background");
                    output5.classList.remove("blue-background");
                    output6.classList.remove("blue-background");
                    output7.classList.remove("blue-background");
                    output8.classList.remove("blue-background");

        break;
    default:
            console.log('Exceeded max number of outputs');
            // Clear all outputs and reset the array
            output1.textContent = '';
            output2.textContent = '';
            output3.textContent = '';
            output4.textContent = '';
            output5.textContent = '';
            output6.textContent = '';
            output7.textContent = '';
            output8.textContent = '';
            output9.textContent = '';

            myArray = []; // Reset the array
            break;

};
    })
    .catch(error => {
        // Handle error
    });




// based on the length of array, set content on different output elements


startButton.addEventListener('click', () => {
    if (!isRecognizing) {
    console.log('Speech recognition started');
    recognition.start();
    }
});
};

        startButton.addEventListener('click', () => {
            console.log('Speech recognition started');
            recognition.start();
        });
    </script>



<!--    <script>

        const startButton = document.getElementById('startButton');
        const output = document.getElementById('output');
        const recognition = new webkitSpeechRecognition(); // For Chrome, use webkitSpeechRecognition
        const output1 = document.getElementById('output1');  // Output element 1
        const output2 = document.getElementById('output2');  // Output element 2
        const output3 = document.getElementById('output3');  // Output element 3
        const output4 = document.getElementById('output4');  // Output element 4
        const output5 = document.getElementById('output5');  // Output element 5
        const output6 = document.getElementById('output6');  // Output element 5
        const output7 = document.getElementById('output7');  // Output element 5
        const output8 = document.getElementById('output8');  // Output element 5
        const output9 = document.getElementById('output9');  // Output element 5

        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = 'ur-PK';
        let sentences = []; // Declare and initialize the sentences array here
        let myArray = []
        const maxSentences = 10;
        recognition.onstart = () => {
            console.log('Speech recognition started');
        };

        recognition.onerror = (event) => {
            console.error('Speech recognition error:', event.error);
            recognition.start();
        };

        recognition.onresult = (event) => {
            const transcript = event.results[event.results.length - 1][0].transcript;

  console.log('Speech recognition result', transcript);
// push transcript to array
myArray.push(transcript);

// based on the length of array, set content on different output elements
switch (myArray.length) {
    case 1:
        output1.textContent = transcript;
        break;
    case 2:
        output2.textContent = transcript;
        break;
    case 3:
        output3.textContent = transcript;
        break;
    case 4:
        output4.textContent = transcript;
        break;
    case 5:
        output5.textContent = transcript;
        break;
        case 6:
        output6.textContent = transcript;
        break;
            case 7:
        output7.textContent = transcript;
        break;
          case 8:
        output8.textContent = transcript;
        break;
          case 9:
        output9.textContent = transcript;
        break;
    default:
            console.log('Exceeded max number of outputs');
            // Clear all outputs and reset the array
            output1.textContent = '';
            output2.textContent = '';
            output3.textContent = '';
            output4.textContent = '';
            output5.textContent = '';
            output6.textContent = '';
            output7.textContent = '';
            output8.textContent = '';
            output9.textContent = '';

            // ... include clear statements for output3 to output9 ...
            output9.textContent = '';
            myArray = []; // Reset the array
            break;

};

startButton.addEventListener('click', () => {
    console.log('Speech recognition started');
    recognition.start();
});
};


        startButton.addEventListener('click', () => {
            console.log('Speech recognition started');
            recognition.start();
        });
    </script>-->

</body>
</html>